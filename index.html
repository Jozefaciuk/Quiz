<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZ</title>
    <style>
        :root {
            --background-color: #f9f9f9;
            --text-color: #333;
            --card-bg-color: #ffffff;
            --card-border-color: #e0e0e0;
            --button-bg-color: #007BFF;
            --button-hover-color: #0056b3;
            --correct-bg-color: #d4edda;
            --correct-border-color: #28a745;
            --incorrect-bg-color: #f8d7da;
            --incorrect-border-color: #f5c6cb;
        }

        [data-theme="dark"] {
            --background-color: #121212;
            --text-color: #f0f0f0;
            --card-bg-color: #1e1e1e;
            --card-border-color: #333;
            --button-bg-color: #1e88e5;
            --button-hover-color: #1565c0;
            --correct-bg-color: #355e3b;
            --correct-border-color: #4caf50;
            --incorrect-bg-color: #5a1e1e;
            --incorrect-border-color: #f44336;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            width: 100%;
            padding: 20px;
        }

        .card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            margin: 0 0 10px;
        }

        .options {
            list-style: none;
            padding: 0;
        }

        .options li {
            margin-bottom: 10px;
        }

        .submit-btn {
            display: block;
            width: 100%;
            margin-top: 20px;
            padding: 10px;
            background-color: var(--button-bg-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .submit-btn:hover {
            background-color: var(--button-hover-color);
        }

        .correct {
            color: #155724;
            background-color: var(--correct-bg-color);
            border: 1px solid var(--correct-border-color);
            padding: 5px;
            border-radius: 5px;
        }

        .incorrect {
            color: #721c24;
            background-color: var(--incorrect-bg-color);
            border: 1px solid var(--incorrect-border-color);
            padding: 5px;
            border-radius: 5px;
        }

	[data-theme="dark"] .correct {
	    color: white !important;
	}

	[data-theme="dark"] .incorrect {
	    color: grey !important; /* Light red text for dark mode */
	}

        .theme-toggle {
            display: block;
            margin: 20px auto;
            padding: 10px;
            background-color: var(--button-bg-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .theme-toggle:hover {
            background-color: var(--button-hover-color);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .submit-btn {
                font-size: 14px;
            }

            .theme-toggle {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">Switch to Dark Mode</button>
    <div class="container">
        <div class="card">
            <h1>QUZI - Test</h1>
            <label for="jsonFile">Upload questions JSON:</label>
            <input type="file" id="jsonFile" accept=".json">
            <label for="start">Start Question:</label>
            <input type="number" id="start" min="1" max="198" value="1">
            <label for="end">End Question:</label>
            <input type="number" id="end" min="1" max="198" value="22">
            <button onclick="loadQuiz()" class="submit-btn">Load Quiz</button>
        </div>
        <div id="quiz-container"></div>
        <div id="error-container" class="card" style="display: none;"></div>
    </div>

    <script>
        let questions = [];
        let isDarkMode = false;

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
            document.querySelector('.theme-toggle').innerText = isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode';
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /*
        async function loadQuiz() {
            const start = parseInt(document.getElementById('start').value);
            const end = parseInt(document.getElementById('end').value);
            const quizContainer = document.getElementById('quiz-container');
            const errorContainer = document.getElementById('error-container');
            quizContainer.innerHTML = '';
            errorContainer.style.display = 'none';

            try {
                //const response = await fetch('kompo_questions.json');
                //if (!response.ok) {
                //    throw new Error(`Failed to load questions: ${response.status} ${response.statusText}`);
                //}

                //questions = await response.json();
                let filteredQuestions = questions.filter(q => q.number >= start && q.number <= end);

                if (filteredQuestions.length === 0) {
                    throw new Error(`No questions found in the range ${start} to ${end}.`);
                }

                shuffleArray(filteredQuestions);

                filteredQuestions.forEach(q => {
                    shuffleArray(q.answers); // Shuffle the answers

                    const questionDiv = document.createElement('div');
                    questionDiv.classList.add('card');
                    questionDiv.id = `q${q.number}`;

                    const questionTitle = document.createElement('h3');
                    questionTitle.innerHTML = `${q.description}`; // Hide question number initially
                    questionTitle.setAttribute("data-question-number", q.number);
                    questionDiv.appendChild(questionTitle);

                    const form = document.createElement('form');
                    form.onsubmit = event => handleSubmit(event, q.number);

                    const optionsList = document.createElement('ul');
                    optionsList.classList.add('options');

                    q.answers.forEach(answer => {
                        const listItem = document.createElement('li');
                        const label = document.createElement('label');
                        const input = document.createElement('input');
                        input.type = 'checkbox';
                        input.name = `q${q.number}`;
                        input.value = answer.content;
                        label.appendChild(input);
                        label.innerHTML += ` ${answer.content}`;
                        listItem.appendChild(label);
                        optionsList.appendChild(listItem);
                    });

                    form.appendChild(optionsList);

                    const submitButton = document.createElement('button');
                    submitButton.type = 'submit';
                    submitButton.classList.add('submit-btn');
                    submitButton.innerText = 'Submit';
                    form.appendChild(submitButton);

                    const resultDiv = document.createElement('div');
                    resultDiv.classList.add('result');
                    resultDiv.id = `result-q${q.number}`;
                    form.appendChild(resultDiv);

                    questionDiv.appendChild(form);
                    quizContainer.appendChild(questionDiv);
                });

                // Add Final Submit Button
                const finalSubmitButton = document.createElement('button');
                finalSubmitButton.classList.add('submit-btn');
                finalSubmitButton.innerText = 'Final Submit';
                finalSubmitButton.onclick = handleFinalSubmit;
                quizContainer.appendChild(finalSubmitButton);

                // Container for incorrect questions
                const finalResultDiv = document.createElement('div');
                finalResultDiv.id = 'final-result';
                finalResultDiv.classList.add('card');
                finalResultDiv.style.display = 'none';
                quizContainer.appendChild(finalResultDiv);

            } catch (error) {
                errorContainer.style.display = 'block';
                errorContainer.innerHTML = error.message;
            }
        }*/

        async function loadQuiz() {
            const start = parseInt(document.getElementById('start').value);
            const end = parseInt(document.getElementById('end').value);
            const quizContainer = document.getElementById('quiz-container');
            const errorContainer = document.getElementById('error-container');
            const fileInput = document.getElementById('jsonFile');

            quizContainer.innerHTML = '';
            errorContainer.style.display = 'none';
            incorrectQuestions = [];


            if (!fileInput.files.length) {
                errorContainer.style.display = 'block';
                errorContainer.innerHTML = 'Please upload a JSON file with questions.';
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = () => {
                try {
                    questions = JSON.parse(reader.result);

                    let filteredQuestions = questions.filter(
                        q => Number(q.number) >= start && Number(q.number) <= end
                    );

                    if (filteredQuestions.length === 0) {
                        throw new Error(`No questions found in range ${start}â€“${end}`);
                    }

                    shuffleArray(filteredQuestions);

                    filteredQuestions.forEach(q => {
                        shuffleArray(q.answers);

                        const questionDiv = document.createElement('div');
                        questionDiv.classList.add('card');
                        questionDiv.id = `q${q.number}`;

                        const questionTitle = document.createElement('h3');
                        questionTitle.innerHTML = q.description;
                        questionTitle.setAttribute("data-question-number", q.number);
                        questionDiv.appendChild(questionTitle);

                        const form = document.createElement('form');
                        form.onsubmit = event => handleSubmit(event, q.number);

                        const optionsList = document.createElement('ul');
                        optionsList.classList.add('options');

                        q.answers.forEach(answer => {
                            const li = document.createElement('li');
                            const label = document.createElement('label');
                            const input = document.createElement('input');

                            input.type = 'checkbox';
                            input.name = `q${q.number}`;
                            input.value = answer.content;

                            label.appendChild(input);
                            label.innerHTML += ` ${answer.content}`;

                            li.appendChild(label);
                            optionsList.appendChild(li);
                        });

                        form.appendChild(optionsList);

                        const submitButton = document.createElement('button');
                        submitButton.type = 'submit';
                        submitButton.classList.add('submit-btn');
                        submitButton.innerText = 'Submit';
                        form.appendChild(submitButton);

                        const resultDiv = document.createElement('div');
                        resultDiv.id = `result-q${q.number}`;
                        form.appendChild(resultDiv);

                        questionDiv.appendChild(form);
                        quizContainer.appendChild(questionDiv);
                    });

                    const finalSubmitButton = document.createElement('button');
                    finalSubmitButton.classList.add('submit-btn');
                    finalSubmitButton.innerText = 'Final Submit';
                    finalSubmitButton.onclick = handleFinalSubmit;
                    quizContainer.appendChild(finalSubmitButton);

                    const finalResultDiv = document.createElement('div');
                    finalResultDiv.id = 'final-result';
                    finalResultDiv.classList.add('card');
                    finalResultDiv.style.display = 'none';
                    quizContainer.appendChild(finalResultDiv);

                } catch (err) {
                    errorContainer.style.display = 'block';
                    errorContainer.innerHTML = err.message;
                }
            };

            reader.readAsText(file);
        }


        let incorrectQuestions = []; // Array to track incorrect answers

        function handleSubmit(event, questionId) {
            event.preventDefault();
            const form = event.target;
            const selectedOptions = Array.from(form.querySelectorAll(`input[name='q${questionId}']:checked`)).map(opt => opt.value);
            const resultDiv = document.getElementById(`result-q${questionId}`);
            const allOptions = form.querySelectorAll(`input[name='q${questionId}']`);
            const questionTitle = form.closest(".card").querySelector("h3");

            const correctAnswers = questions.find(q => q.number == questionId).answers.filter(a => a.correct).map(a => a.content);
            
            allOptions.forEach(option => {
                const parentLabel = option.parentElement;
                parentLabel.classList.remove('correct', 'incorrect');
                if (correctAnswers.includes(option.value)) {
                    parentLabel.classList.add('correct');
                } else if (option.checked) {
                    parentLabel.classList.add('incorrect');
                }
            });

            if (arraysEqual(selectedOptions, correctAnswers)) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = 'Correct!';
                incorrectQuestions = incorrectQuestions.filter(q => q !== questionId); // Remove from incorrect list if answered correctly
            } else {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = 'Incorrect!';
                if (!incorrectQuestions.includes(questionId)) {
                    incorrectQuestions.push(questionId); // Track incorrect question
                }
            }

            // Reveal the question number after submission
           //questionTitle.innerHTML = `Question ${questionTitle.getAttribute("data-question-number")}: ${questionTitle.innerHTML}`;
           questionTitle.innerHTML = `Question ${questionTitle.getAttribute("data-question-number")}: ${questions.find(q => q.number == questionId).description}`;

        }

        function handleFinalSubmit() {
            const finalResultDiv = document.getElementById('final-result');
            finalResultDiv.style.display = 'block';

            if (incorrectQuestions.length === 0) {
                finalResultDiv.innerHTML = '<strong>Congratulations!</strong> You answered all questions correctly!';
            } else {
                finalResultDiv.innerHTML = `<strong>Incorrect Questions:</strong> ${incorrectQuestions.join(', ')}`;
            }
        }



        function arraysEqual(arr1, arr2) {
            return arr1.length === arr2.length && arr1.sort().every((value, index) => value === arr2.sort()[index]);
        }
    </script>
</body>
</html>
